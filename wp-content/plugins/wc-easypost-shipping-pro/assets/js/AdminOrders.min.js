(function(t){function e(t){this.settings=t,this.lastNoticeElement=jQuery(),this.labelLoaderPage=new LabelLoaderPage(t.id),jQuery(document).on("submit","#posts-filter",this.onFormSubmit.bind(this)),jQuery(document).on("click","#doaction, #doaction2",this.onActionButtonClick.bind(this)),jQuery(document).on("click","."+this.settings.id+".adminOrders input",this.onClick.bind(this)),jQuery(document).on("click","."+this.settings.id+".adminOrders",this.onClick.bind(this)),jQuery(document).on("click","."+this.settings.id+".adminOrders button.submit",this.onUpdateOrder.bind(this))}e.prototype.onFormSubmit=function(){this.setUpdateOrderFieldsDisabled(!0)},e.prototype.onActionButtonClick=function(t){this.lastNoticeElement.remove();var e=jQuery("#posts-filter"),i=e.find("[name=action]").val();return"-1"==i&&(i=e.find("[name=action2]").val()),!(i.indexOf(this.settings.id)>=0)||(i.indexOf("download")>=0&&this.labelLoaderPage.open(),this.submitAction(t,i),e.find("[name=action]").val("-1"),e.find("[name=action2]").val("-1"),e.find('[name="post[]"]').prop("checked",!1),!1)},e.prototype.onClick=function(t){return t.preventDefault(),t.stopPropagation(),!1},e.prototype.submitAction=function(t,e){this.setUpdateOrderFieldsDisabled(!0);var i=jQuery("#posts-filter"),n=this.getRequestData(e,i.find(":input").not("button,:disabled,[name=action],[name=action2]").serialize());this.block(jQuery(".wrap"));var r=this;jQuery.post(ajaxurl,n,function(t){r.onSubmitActionResponse(t)})},e.prototype.onSubmitActionResponse=function(t){var e=jQuery("<div>"+t+"</div>"),i=e.find("a[href].postageLabelsAndForms."+this.settings.id);if(i.length>0){var n=i.attr("href");n&&n.length>0&&this.labelLoaderPage.navigate(n)}else this.labelLoaderPage.close();e.find(".notice").length>0?(jQuery(window).scrollTop(0),this.lastNoticeElement=e.find(".notice"),this.lastNoticeElement.insertBefore(jQuery(".subsubsub").prev("h2.screen-reader-text"))):this.lastNoticeElement=jQuery(),this.displayAllOrderShipments(e.find("[data-order_id].orderShipments."+this.settings.id)),this.setUpdateOrderFieldsDisabled(!1),this.unblock(jQuery(".wrap"))},e.prototype.displayAllOrderShipments=function(t){var e=this;t.each(function(t,i){e.displayOrderShipments(jQuery(i))})},e.prototype.displayOrderShipments=function(t){var e=t.data("order_id"),i=jQuery('[data-order_id="'+e+'"].orderShipments.'+this.settings.id);if(i.length>0){var n=this;t.find("[data-order_id][data-shipment_id].orderShipment."+this.settings.id).each(function(t,e){n.displayOrderShipment(jQuery(e))})}else{var r=jQuery("#post-"+e).find(".shipment_tracking");r.find("."+this.settings.id+".adminOrders").remove(),r.append(t.prop("outerHTML"))}},e.prototype.displayOrderShipment=function(t){var e=t.data("order_id"),i=t.data("shipment_id"),n=jQuery('[data-order_id="'+e+'"][data-shipment_id="'+i+'"].orderShipment.'+this.settings.id);n.length>0?n.html(t.html()):(n=jQuery('[data-order_id="'+e+'"].orderShipments.'+this.settings.id),n.length>0&&n.append(t))},e.prototype.onUpdateOrder=function(t){jQuery(".adminOrders > .error, .adminOrders > .updated").remove();var e=jQuery(t.target).closest(".adminOrders"),i=this.getRequestData(this.settings.id+"_updateOrders",e.find(":input").not("button").serialize());this.block(e);var n=this;return jQuery.post(ajaxurl,i,function(e){n.onUpdateOrderResponse(t,e)}),!1},e.prototype.onUpdateOrderResponse=function(t,e){var i=jQuery(t.target).closest(".adminOrders");e.length>0&&(i.prepend(e),jQuery(e).hasClass("updated")&&(i.find(".add.submit.button").css({display:"none"}),i.find(".update.submit.button").css({display:"inline-block"}))),this.unblock(i)},e.prototype.getRequestData=function(t,e){return"action="+t+"&"+this.settings.id+"_nonce="+jQuery("#_wpnonce").val()+"&"+e},e.prototype.block=function(t){t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},e.prototype.unblock=function(t){t.unblock()},e.prototype.setUpdateOrderFieldsDisabled=function(t){var e=jQuery(".adminOrders :input");e.prop("disabled",t)},new e(t)})(adminorders_settings);